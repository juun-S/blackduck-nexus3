**Date**: 2026-02-19
**Author**: Full-stack Developer & DevSecOps Engineer

---

## 1. 개요 (Overview)
본 보고서는 Nexus Repository CE 3.87.2-01 및 Java 21 환경 호환성을 확보하기 위해 진행된 `blackduck-nexus3` 플러그인의 마이그레이션 및 리팩토링 작업 결과를 요약합니다. 제거된 Legacy Storage API를 Content API로 대체하고, Deprecated 된 Black Duck Service를 최신 클라이언트 API로 전환하는 작업이 중점적으로 수행되었습니다.

---

## 2. 금일 구현 기능 (Daily Implementation Features)

### 2.1 Black Duck 연동 및 백엔드 로직 (Back-end Logic)

#### **1) 의존성 및 환경 구성 (Dependency & Configuration)**
- **Java 21 전환**: `pom.xml`의 `maven.compiler.source/target`을 21로 상향 조정하고 로컬 JDK 설정을 완료했습니다.
- **라이브러리 마이그레이션**:
    - `com.blackducksoftware.integration` -> `com.synopsys.integration` 그룹으로 변경.
    - `blackduck-common` (66.2.19) 및 `integration-common` (26.1.2) 등 최신 SDK 적용.
    - `nexus-repository-content` 및 `nexus-repository-core` (3.87.2-01) 의존성 추가.

#### **2) Core API 마이그레이션 (Nexus Storage -> Content API)**
Legacy Storage API가 제거됨에 따라, 데이터 조회 및 처리 로직을 전면 재작성했습니다.

| 변경 대상 | 기존 (Legacy API) | 변경 후 (Content API) | 상태 |
| :--- | :--- | :--- | :--- |
| **Facet** | `StorageFacet` | `ContentFacet` | 완료 |
| **Asset** | `Asset` (Storage) | `FluentAsset` (Content) | 완료 |
| **Query** | `Query` (Ohm) | `FluentQuery` / `Stream` API | 완료 |
| **Manager** | `QueryManager` | `ContentFacet` 기반 로직으로 재구현 | 완료 |

#### **3) Black Duck Service 리팩토링**
Deprecated 된 `BlackDuckService` 사용을 중단하고, 최신 `BlackDuckServicesFactory` 패턴을 적용했습니다.

- **`InspectorTask.java`**:
    - `BlackDuckService` 의존성 제거.
    - `BlackDuckApiClient`, `ComponentService`, `ProjectService` 등을 개별적으로 생성하여 사용.
- **`CommonMetaDataProcessor.java`**:
    - `TagService` 메서드 시그니처 변경 (Factory 주입 방식).
    - `Risk Profile` 관련 로직 일시 주석 처리 (API 버전 호환성 문제 해결 대기).
- **`PhoneHome.java`**:
    - `BlackDuckService` 의존성을 제거하고 `BlackDuckApiClient` 사용.

---

## 3. 코드 변경 사항 (Code Changes)

> [!note]
> 주요 파일 변경 요약

<details>
<summary><b>1. pom.xml</b></summary>

```xml
<properties>
    <nexusVersion>3.87.2-01</nexusVersion>
    <maven.compiler.source>21</maven.compiler.source>
    <blackduck.common.version>66.2.19</blackduck.common.version>
</properties>

<dependency>
    <groupId>org.sonatype.nexus</groupId>
    <artifactId>nexus-repository-content</artifactId>
    <version>${nexusVersion}</version>
    <scope>provided</scope>
</dependency>
```
</details>

<details>
<summary><b>2. InspectorTask.java (Service Factory Pattern)</b></summary>

```java
// Before
// BlackDuckService blackDuckService = blackDuckServicesFactory.createBlackDuckService();

// After
BlackDuckApiClient blackDuckApiClient = blackDuckServicesFactory.getBlackDuckApiClient();
ComponentService componentService = blackDuckServicesFactory.createComponentService();
// ... 각 서비스 개별 생성
```
</details>

<details>
<summary><b>3. RepositoryScanner.java (Content API)</b></summary>

```java
// Before (Query 사용)
// Iterable<Asset> assets = storageTx.findAssets(query, null);

// After (Stream & Content API)
// PagedResult<Asset> assets = retrievePagedAssets(repository, filter);
// Stream 처리를 통해 자산 순회
```
</details>

---

## 4. 특이 사항 및 이슈 (Special Notes & Issues)

### 4.1 빌드 실패 (Build Failure)
- **증상**: `mvn clean package` 실행 시 컴파일 에러 발생.
- **원인**:
    1. `blackduck-common-api` 라이브러리의 버전 불일치로 인한 클래스(`ComponentVersionRiskProfileRiskDataCountsView` 등) 참조 실패.
    2. `maven-central`에 존재하지 않는 버전(`2024.4.1.4`) 지정 오류.
- **조치**: 로컬에 존재하는 `2023.4.2.5` 버전으로 롤백 시도했으나, 여전히 API 불일치 문제 발생 중.

### 4.2 기능 제한 (Feature Limitation)
- **Risk Profile**: 호환되는 Risk 관련 클래스를 찾을 때까지 `CommonMetaDataProcessor`의 Risk 평가 로직을 **일시적으로 비활성화**했습니다.
- **TagService**: `BlackDuckService` 제거에 따라 태그 로직의 정상 동작 여부를 추가 검증해야 합니다.

---

## 5. 차후 계획 (Next Action)

1. **빌드 정상화 (Build Fix)**
    - `blackduck-common`과 호환되는 정확한 `blackduck-common-api` 버전 탐색.
    - 잔여 컴파일 에러(`BdioUploadService` 등 패키지 이동 문제) 수정.

2. **단위 테스트 및 검증 (Test & Verification)**
    - `mvn package` 성공 후 단위 테스트 실행.
    - 로컬 Nexus 인스턴스에 플러그인 번들 설치 및 구동 테스트.

3. **기능 복구 (Feature Restoration)**
    - 주석 처리된 Risk Profile 로직을 최신 API에 맞춰 재구현.
